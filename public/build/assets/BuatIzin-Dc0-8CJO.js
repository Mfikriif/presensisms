import{r as o,j as e,M as j}from"./app-Douwlqs5.js";import{M as k}from"./MainLayout-BgxDTXFT.js";import{S as a}from"./sweetalert2.esm.all-BkU8I-GU.js";function v(){const[c,d]=o.useState(""),[r,f]=o.useState(""),[m,h]=o.useState(""),[n,p]=o.useState(null),[i,g]=o.useState(!1),w=async s=>{const t=s.target.value;d(t);try{await(await fetch("/presensi/cekpengajuanizin",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({tanggal_izin:t})})).json()===1?(g(!0),a.fire({title:"Oops!",text:"Anda sudah mengajukan izin pada tanggal ini! Silakan pilih tanggal lain.",icon:"warning",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"},didClose:()=>{d("")}})):g(!1)}catch(l){console.error("Error checking date:",l),a.fire({title:"Error!",text:"Terjadi kesalahan saat memeriksa tanggal izin.",icon:"error",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"}})}},x=async s=>{if(s.preventDefault(),i){a.fire({title:"Gagal!",text:"Anda sudah mengajukan izin untuk tanggal ini.",icon:"error",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"}});return}if(!c||!r||!m){a.fire({title:"Oops!",text:"Semua field wajib diisi.",icon:"warning",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"}});return}if(r==="s"&&!n){a.fire({title:"Oops!",text:"Bukti sakit wajib diunggah!",icon:"warning",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"}});return}const t=new FormData;t.append("tanggal_izin",c),t.append("status",r),t.append("keterangan",m),n&&t.append("file",n),t.append("_token",document.querySelector('meta[name="csrf-token"]').content);try{const u=await(await fetch("/presensi/storeizin",{method:"POST",body:t})).json();u.success?a.fire({title:"Berhasil!",text:u.message,icon:"success",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"},didClose:()=>{window.location.href="/presensi/izin"}}):a.fire({title:"Gagal!",text:u.message||"Terjadi kesalahan.",icon:"error",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"}})}catch{a.fire({title:"Error!",text:"Terjadi kesalahan saat mengirim data.",icon:"error",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"}})}},b=s=>{const t=s.target.files[0];if(t){if(t.type!=="application/pdf"){a.fire({title:"Format File Tidak Didukung",text:"Hanya diperbolehkan file dalam format PDF.",icon:"error",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"}}),s.target.value="",p(null);return}if(t.size>2*1024*1024){a.fire({title:"Ukuran File Terlalu Besar",text:"Maksimal ukuran file adalah 2MB.",icon:"error",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"}}),s.target.value="",p(null);return}p(t)}};return e.jsxs(k,{children:[e.jsx(j,{title:"Buat Izin | E-Presensi SMS"}),e.jsxs("div",{className:"bg-gray-100 min-h-screen overflow-y-auto relative",children:[e.jsxs("div",{className:"bg-blue-950 text-white flex items-center justify-between px-4 py-3 shadow-md",children:[e.jsxs("button",{onClick:()=>window.history.back(),className:"flex items-center text-white",children:[e.jsx("ion-icon",{name:"chevron-back-outline",className:"text-2xl"}),e.jsx("span",{className:"ml-2 text-sm",children:"Kembali"})]}),e.jsx("h1",{className:"text-lg font-semibold",children:"Form Izin"})]}),e.jsx("div",{className:"p-4",children:e.jsxs("form",{onSubmit:x,className:"space-y-4",encType:"multipart/form-data",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("input",{type:"date",id:"tanggal_izin",name:"tanggal_izin",value:c,onChange:w,className:`w-full px-4 py-2 border rounded-md focus:ring ${i?"border-red-500 bg-red-100":"border-gray-300 focus:ring-blue-200 focus:border-blue-500"}`,placeholder:"Tanggal"}),i&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Anda sudah mengajukan izin pada tanggal ini."})]}),e.jsx("div",{className:"form-group",children:e.jsxs("select",{name:"status",id:"status",value:r,onChange:s=>f(s.target.value),className:"w-full px-4 py-2 border rounded-md focus:ring focus:ring-blue-200 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Izin / Sakit"}),e.jsx("option",{value:"i",children:"Izin"}),e.jsx("option",{value:"s",children:"Sakit"})]})}),e.jsx("div",{className:"form-group",children:e.jsx("textarea",{name:"keterangan",id:"keterangan",value:m,onChange:s=>h(s.target.value),cols:"30",rows:"5",className:"w-full px-4 py-2 border rounded-md focus:ring focus:ring-blue-200 focus:border-blue-500",placeholder:"Keterangan"})}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"block text-md font-medium text-gray-700 mt-1 mb-1",children:["Upload Bukti Sakit (PDF)"," ",r==="s"&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"file",name:"file",accept:".pdf, .jpg, .jpeg, .png",onChange:b,className:"w-full px-4 py-2 border rounded-md focus:ring focus:ring-blue-200 focus:border-blue-500"}),r==="s"&&!n&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Bukti sakit wajib diunggah!"}),n&&n.type==="application/pdf"&&e.jsxs("p",{className:"text-green-600 text-sm mt-1",children:["File terpilih: ",n.name]})]}),e.jsx("div",{className:"form-group",children:e.jsx("button",{type:"submit",className:"w-full bg-blue-950 text-white py-2 px-4 rounded-md shadow hover:bg-blue-900 transition duration-200 disabled:bg-gray-400",disabled:i,children:"Kirim"})})]})})]})]})}export{v as default};
