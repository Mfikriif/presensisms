import{r as u,j as a}from"./app-BUGKuYZp.js";import{A as E}from"./AuthenticatedLayout-fekp91K1.js";import{F as $}from"./index-DPXi8JDA.js";import{M as S}from"./index-ptDhk-0Y.js";import{u as h,w as C,F as B}from"./FileSaver.min-D8n0Duba.js";import"./ApplicationLogo-CJAeBEut.js";import"./transition-DT67-FPA.js";function R({namabulan:x=[],tahun_awal:p=2022,namaPegawai:j}){const[t,k]=u.useState(""),[i,f]=u.useState(""),[r,w]=u.useState(""),[d,l]=u.useState(!1),b=new Date().getFullYear(),P=()=>{if(!t||!i||!r){alert("Pilih bulan, tahun, dan nama pegawai terlebih dahulu.");return}const e=route("laporan.cetakPegawai")+`?bulan=${t}&tahun=${i}&idPegawai=${r}`;window.open(e,"_blank")},_=(e,s)=>{if(!e||!s)return"0 jam";const c=new Date(`1970-01-01T${e}Z`);return`${((new Date(`1970-01-01T${s}Z`)-c)/(1e3*60*60)).toFixed(2)} jam`},v=async()=>{if(!t||!i||!r){alert("Pilih bulan, tahun, dan nama pegawai terlebih dahulu.");return}l(!0);try{const e=await fetch(route("laporan.exportExcel",{bulan:t,tahun:i,idPegawai:r}));if(!e.ok)throw new Error("Gagal mengambil data histori pegawai");const s=await e.json();if(!s.dataPresensi||s.dataPresensi.length===0){alert("Tidak ada data presensi untuk kriteria yang dipilih."),l(!1);return}if(!s.statusPresensi||s.statusPresensi.length===0){alert("Tidak ada data status presensi untuk kriteria yang dipilih."),l(!1);return}const c=s.dataPresensi.map((n,D)=>{const o=s.statusPresensi.find(F=>F.tanggal_presensi===n.tanggal_presensi);return{No:D+1,"Nama Pegawai":n.nama||"Tidak Diketahui","Tanggal Presensi":n.tanggal_presensi||"-","Jam Presensi":n.jam_in||"Tidak Hadir","Jam Pulang":n.jam_out||"Belum absen pulang","Akhir Jam Masuk":o.akhir_jam_masuk||"Belum absen pulang","Status Presensi":o&&o.akhir_jam_masuk?n.jam_in>o.akhir_jam_masuk?"Terlambat":"Tepat Waktu":"Tidak ada data","Jumlah Jam":n.jam_out?_(n.jam_in,n.jam_out):"0 jam"}}),g=h.json_to_sheet(c),m=h.book_new();h.book_append_sheet(m,g,"Laporan Presensi");const T=C(m,{bookType:"xlsx",type:"array"}),y=new Blob([T],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),N=`Laporan_Presensi_${s.dataPresensi.length>0&&s.dataPresensi[0].nama||"Tidak Diketahui"}_${t}_${i}.xlsx`;B.saveAs(y,N)}catch(e){console.error("Error fetching data:",e),alert("Terjadi kesalahan saat mengambil data.")}l(!1)};return a.jsx(a.Fragment,{children:a.jsx(E,{header:a.jsx(a.Fragment,{children:"Laporan Presensi"}),children:a.jsx(a.Fragment,{children:a.jsx("div",{className:"ml-20",children:a.jsxs("div",{className:" w-2/4 bg-white shadow-lg rounded-lg",children:[a.jsxs("div",{className:"flex flex-col px-5 py-5",children:[a.jsxs("select",{className:"mb-4 h-9 rounded-lg",name:"bulan",id:"bulan",value:t,onChange:e=>k(e.target.value),children:[a.jsx("option",{value:"",children:"Pilih Bulan"}),x.map((e,s)=>a.jsx("option",{value:s+1,children:e},s))]}),a.jsxs("select",{id:"tahun",value:i,onChange:e=>f(e.target.value),className:"mb-4 h-9 rounded-lg",children:[a.jsx("option",{value:"",children:"Tahun"}),Array.from({length:b-p+1},(e,s)=>p+s).map(e=>a.jsx("option",{value:e,children:e},e))]}),a.jsxs("select",{className:"mb-4 h-9 rounded-lg",name:"nama-pegawai",id:"idPegawai",value:r,onChange:e=>w(e.target.value),children:[a.jsx("option",{value:"",children:"Nama pegawai"}),j.map((e,s)=>a.jsx("option",{value:e.id,children:e.nama_lengkap},s))]})]}),a.jsxs("div",{className:"w-9/12 mx-auto flex flex-row pb-4",children:[a.jsx("button",{onClick:P,disabled:d,className:"bg-green-600 mr-4 rounded-lg text-white w-full py-2",children:a.jsxs("div",{className:"flex justify-center",children:[a.jsx($,{className:"my-auto mr-3"}),a.jsx("p",{children:"Cetak"})]})}),a.jsx("button",{onClick:v,className:"bg-blue-600 rounded-lg text-white w-full py-2",disabled:d,children:a.jsxs("div",{className:"flex justify-center",children:[a.jsx(S,{className:"my-auto mr-3 text-xl"}),a.jsx("p",{children:d?"Exporting...":"Export to Excel"})]})})]})]})})})})})}export{R as default};
