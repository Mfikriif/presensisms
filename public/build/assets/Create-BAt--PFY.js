import{d as A,g as T,r as w,j as u,M as R,b as I}from"./app-ar4AfqUK.js";import{M as W}from"./MainLayout-CWBrXy23.js";import{S as U}from"./sweetalert2.esm.all-BkU8I-GU.js";var j={exports:{}},q=j.exports,O;function B(){return O||(O=1,function(C,P){(function(b,g){C.exports=g(A())})(q,function(M){return function(b){var g={};function s(i){if(g[i])return g[i].exports;var n=g[i]={i,l:!1,exports:{}};return b[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=b,s.c=g,s.d=function(i,n,p){s.o(i,n)||Object.defineProperty(i,n,{enumerable:!0,get:p})},s.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},s.t=function(i,n){if(n&1&&(i=s(i)),n&8||n&4&&typeof i=="object"&&i&&i.__esModule)return i;var p=Object.create(null);if(s.r(p),Object.defineProperty(p,"default",{enumerable:!0,value:i}),n&2&&typeof i!="string")for(var y in i)s.d(p,y,(function(x){return i[x]}).bind(null,y));return p},s.n=function(i){var n=i&&i.__esModule?function(){return i.default}:function(){return i};return s.d(n,"a",n),n},s.o=function(i,n){return Object.prototype.hasOwnProperty.call(i,n)},s.p="",s(s.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(b,g,s){s.r(g);var i=s("react"),n=function(){var d=function(r,e){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var a in o)o.hasOwnProperty(a)&&(t[a]=o[a])},d(r,e)};return function(r,e){d(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}}(),p=function(){return p=Object.assign||function(d){for(var r,e=1,t=arguments.length;e<t;e++){r=arguments[e];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(d[o]=r[o])}return d},p.apply(this,arguments)},y=function(d,r){var e={};for(var t in d)Object.prototype.hasOwnProperty.call(d,t)&&r.indexOf(t)<0&&(e[t]=d[t]);if(d!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,t=Object.getOwnPropertySymbols(d);o<t.length;o++)r.indexOf(t[o])<0&&Object.prototype.propertyIsEnumerable.call(d,t[o])&&(e[t[o]]=d[t[o]]);return e};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(r){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return e?new Promise(function(t,o){e.call(navigator,r,t,o)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function x(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var k=function(d){n(r,d);function r(e){var t=d.call(this,e)||this;return t.canvas=null,t.ctx=null,t.requestUserMediaId=0,t.unmounted=!1,t.state={hasUserMedia:!1},t}return r.prototype.componentDidMount=function(){var e=this,t=e.state,o=e.props;if(this.unmounted=!1,!x()){o.onUserMediaError("getUserMedia not supported");return}t.hasUserMedia||this.requestUserMedia(),o.children&&typeof o.children!="function"&&console.warn("children must be a function")},r.prototype.componentDidUpdate=function(e){var t=this.props;if(!x()){t.onUserMediaError("getUserMedia not supported");return}var o=JSON.stringify(e.audioConstraints)!==JSON.stringify(t.audioConstraints),a=JSON.stringify(e.videoConstraints)!==JSON.stringify(t.videoConstraints),m=e.minScreenshotWidth!==t.minScreenshotWidth,f=e.minScreenshotHeight!==t.minScreenshotHeight;(a||m||f)&&(this.canvas=null,this.ctx=null),(o||a)&&(this.stopAndCleanup(),this.requestUserMedia())},r.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},r.stopMediaStream=function(e){e&&(e.getVideoTracks&&e.getAudioTracks?(e.getVideoTracks().map(function(t){e.removeTrack(t),t.stop()}),e.getAudioTracks().map(function(t){e.removeTrack(t),t.stop()})):e.stop())},r.prototype.stopAndCleanup=function(){var e=this.state;e.hasUserMedia&&(r.stopMediaStream(this.stream),e.src&&window.URL.revokeObjectURL(e.src))},r.prototype.getScreenshot=function(e){var t=this,o=t.state,a=t.props;if(!o.hasUserMedia)return null;var m=this.getCanvas(e);return m&&m.toDataURL(a.screenshotFormat,a.screenshotQuality)},r.prototype.getCanvas=function(e){var t=this,o=t.state,a=t.props;if(!this.video||!o.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var m=this.video.videoWidth,f=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var l=m/f;m=a.minScreenshotWidth||this.video.clientWidth,f=m/l,a.minScreenshotHeight&&f<a.minScreenshotHeight&&(f=a.minScreenshotHeight,m=f*l)}this.canvas=document.createElement("canvas"),this.canvas.width=(e==null?void 0:e.width)||m,this.canvas.height=(e==null?void 0:e.height)||f,this.ctx=this.canvas.getContext("2d")}var v=this,h=v.ctx,c=v.canvas;return h&&c&&(c.width=(e==null?void 0:e.width)||c.width,c.height=(e==null?void 0:e.height)||c.height,a.mirrored&&(h.translate(c.width,0),h.scale(-1,1)),h.imageSmoothingEnabled=a.imageSmoothing,h.drawImage(this.video,0,0,(e==null?void 0:e.width)||c.width,(e==null?void 0:e.height)||c.height),a.mirrored&&(h.scale(-1,1),h.translate(-c.width,0))),c},r.prototype.requestUserMedia=function(){var e=this,t=this.props,o=function(f,l){var v={video:typeof l<"u"?l:!0};t.audio&&(v.audio=typeof f<"u"?f:!0),e.requestUserMediaId++;var h=e.requestUserMediaId;navigator.mediaDevices.getUserMedia(v).then(function(c){e.unmounted||h!==e.requestUserMediaId?r.stopMediaStream(c):e.handleUserMedia(null,c)}).catch(function(c){e.handleUserMedia(c)})};if("mediaDevices"in navigator)o(t.audioConstraints,t.videoConstraints);else{var a=function(f){return{optional:[{sourceId:f}]}},m=function(f){var l=f.deviceId;return typeof l=="string"?l:Array.isArray(l)&&l.length>0?l[0]:typeof l=="object"&&l.ideal?l.ideal:null};MediaStreamTrack.getSources(function(f){var l=null,v=null;f.forEach(function(S){S.kind==="audio"?l=S.id:S.kind==="video"&&(v=S.id)});var h=m(t.audioConstraints);h&&(l=h);var c=m(t.videoConstraints);c&&(v=c),o(a(l),a(v))})}},r.prototype.handleUserMedia=function(e,t){var o=this.props;if(e||!t){this.setState({hasUserMedia:!1}),o.onUserMediaError(e);return}this.stream=t;try{this.video&&(this.video.srcObject=t),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(t)})}o.onUserMedia(t)},r.prototype.render=function(){var e=this,t=this,o=t.state,a=t.props,m=a.audio;a.forceScreenshotSourceSize;var f=a.disablePictureInPicture;a.onUserMedia,a.onUserMediaError,a.screenshotFormat,a.screenshotQuality,a.minScreenshotWidth,a.minScreenshotHeight,a.audioConstraints,a.videoConstraints,a.imageSmoothing;var l=a.mirrored,v=a.style,h=v===void 0?{}:v,c=a.children,S=y(a,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),_=l?p(p({},h),{transform:(h.transform||"")+" scaleX(-1)"}):h,E={getScreenshot:this.getScreenshot.bind(this)};return i.createElement(i.Fragment,null,i.createElement("video",p({autoPlay:!0,disablePictureInPicture:f,src:o.src,muted:!m,playsInline:!0,ref:function(N){e.video=N},style:_},S)),c&&c(E))},r.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},r}(i.Component);g.default=k},react:function(b,g){b.exports=M}}).default})}(j)),j.exports}var z=B();const G=T(z);function Q({cek:C}){const[P,M]=w.useState(!1),[b]=w.useState(!1),[g,s]=w.useState(null),[i,n]=w.useState(""),p=w.useRef(null),y=w.useRef(null),[x,k]=w.useState(C===0);w.useEffect(()=>{setTimeout(()=>{b(!0)},3e3),navigator.geolocation?navigator.geolocation.getCurrentPosition(r=>{const e=`${r.coords.latitude},${r.coords.longitude}`;s(e),p.current&&(p.current.value=e);const t=L.map("map").setView([r.coords.latitude,r.coords.longitude],18);L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(t),L.marker([r.coords.latitude,r.coords.longitude]).addTo(t),L.circle([-7.023826563310556,110.50695887209068],{color:"red",fillColor:"#f03",fillOpacity:.5,radius:20}).addTo(t)},r=>{console.error("Error obtaining location:",r),n("Gagal mendapatkan lokasi. Periksa izin lokasi Anda.")}):n("Browser tidak mendukung geolocation.")},[]);const d=async()=>{if(y.current){const r=y.current.getScreenshot();if(!r){U.fire({icon:"error",title:"Gagal",text:"Gagal menangkap gambar. Coba lagi.",showConfirmButton:!1,timerProgressBar:!0,timer:3e3,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"}});return}if(!g){U.fire({icon:"warning",title:"Lokasi Tidak Tersedia",text:"Ambil lokasi terlebih dahulu.",showConfirmButton:!1,timerProgressBar:!0,timer:3e3,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"}});return}M(!0);try{(await I.post("/presensi/store",{image:r,lokasi:g,tipeAbsen:x?"masuk":"pulang"},{headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).status===200&&(U.fire({icon:"success",title:"Berhasil!",text:x?"Terima kasih, Selamat Bekerja!":"Terima kasih, Hati-Hati di Jalan!",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"},didClose:()=>{window.location.href="/dashboardop"}}),x&&k(!1))}catch(e){if(e.response){const t=e.response.data.message||"Terjadi kesalahan saat absen.";U.fire({icon:"error",title:"Gagal!",text:t,showConfirmButton:!1,timerProgressBar:!0,timer:3e3,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"}})}}finally{M(!1)}}};return u.jsxs(W,{children:[u.jsx(R,{title:"Absen | E-Presensi SMS"}),u.jsxs("div",{className:"bg-gray-100 min-h-screen flex flex-col pb-20 relative pt-16",children:[u.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 bg-blue-950 text-white flex items-center justify-between px-4 py-5 shadow-md",children:[u.jsxs("button",{onClick:()=>window.history.back(),className:"flex items-center text-white hover:text-gray-200",children:[u.jsx("ion-icon",{name:"chevron-back-outline",className:"text-2xl"}),u.jsx("span",{className:"ml-2 text-base",children:"Kembali"})]}),u.jsx("h1",{className:"text-lg font-semibold",children:"E-Presensi"})]}),u.jsxs("div",{className:"flex-grow flex flex-col items-center gap-6 mt-6 px-4",children:[i&&u.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg shadow-md w-full max-w-xs",children:u.jsx("p",{className:"text-sm",children:i})}),u.jsxs("div",{className:"flex flex-col items-center justify-center",children:[u.jsx(G,{audio:!1,ref:y,screenshotFormat:"image/jpeg",className:"rounded-lg shadow-lg border-2 border-gray-350",style:{width:"250px",height:"250px",transform:"scaleX(-1)"}}),u.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Pastikan wajah Anda terlihat jelas."})]}),u.jsxs("button",{onClick:d,className:`${x?"bg-gradient-to-r from-blue-800 to-blue-950 hover:from-blue-800 hover:to-blue-950":"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700"} text-white rounded-full px-8 py-4 flex items-center gap-2 transition duration-300 ease-in-out shadow-lg transform hover:scale-105 focus:outline-none`,children:[u.jsx("ion-icon",{name:"camera-outline",className:"text-2xl"}),u.jsx("span",{className:"font-semibold text-lg",children:x?"Absen Masuk":"Absen Pulang"})]}),u.jsxs("div",{className:"w-full max-w-xs bg-white rounded-lg overflow-hidden shadow-lg",children:[u.jsx("div",{id:"map",className:"bg-gray-100 relative z-0",style:{width:"100%",height:"200px",borderRadius:"10px"}}),u.jsx("p",{className:"text-xs text-gray-500 text-center py-2",children:"Lokasi Anda saat ini."})]})]})]})]})}export{Q as default};
