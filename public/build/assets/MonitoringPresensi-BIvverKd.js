import{r as o,j as e,M as J}from"./app-B8c1BTdD.js";import{G as O,A}from"./AuthenticatedLayout-CudRRKXl.js";import{a as B}from"./index-BjhKQs4K.js";import{R}from"./react-paginate-C3tySxpr.js";import{M as W}from"./Modal-DHwNQTD_.js";import"./ApplicationLogo-CV_Zqwon.js";import"./transition-BnVXVUAU.js";function G(d){return O({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M408 120c0 54.6-73.1 151.9-105.2 192c-7.7 9.6-22 9.6-29.6 0C241.1 271.9 168 174.6 168 120C168 53.7 221.7 0 288 0s120 53.7 120 120zm8 80.4c3.5-6.9 6.7-13.8 9.6-20.6c.5-1.2 1-2.5 1.5-3.7l116-46.4C558.9 123.4 576 135 576 152l0 270.8c0 9.8-6 18.6-15.1 22.3L416 503l0-302.6zM137.6 138.3c2.4 14.1 7.2 28.3 12.8 41.5c2.9 6.8 6.1 13.7 9.6 20.6l0 251.4L32.9 502.7C17.1 509 0 497.4 0 480.4L0 209.6c0-9.8 6-18.6 15.1-22.3l122.6-49zM327.8 332c13.9-17.4 35.7-45.7 56.2-77l0 249.3L192 449.4 192 255c20.5 31.3 42.3 59.6 56.2 77c20.5 25.6 59.1 25.6 79.6 0zM288 152a40 40 0 1 0 0-80 40 40 0 1 0 0 80z"},child:[]}]})(d)}function ee({presensi:d,statusPresensi:_}){const[p,S]=o.useState(""),[h,M]=o.useState(0),i=8,[u,j]=o.useState(!1),[r,T]=o.useState({latitude:0,longitude:0,nama:""}),w=d.filter(a=>`${a.nama} ${a.email} ${a.tanggal_presensi} ${a.jam_in} ${a.jam_out} ${a.lokasi_in} ${a.lokasi_out}`.toLowerCase().includes(p.toLowerCase())),C=({selected:a})=>{M(a)};function v(a,t){const s=a.split(","),n=s[0],l=s[1];T({latitude:n,longitude:l,nama:t}),j(!0)}function P(a,t){if(!a)return null;const[s,n,l]=a.split(":").map(Number),[c,x,m]=t.split(":").map(Number),N=new Date(0,0,0,s,n,l),k=new Date(0,0,0,c,x,m);if(N<=k)return"00:00:00";const g=N-k,K=Math.floor(g/(1e3*60*60)),z=Math.floor(g%(1e3*60*60)/(1e3*60)),I=Math.floor(g%(1e3*60)/1e3);return`${K.toString().padStart(2,"0")}:${z.toString().padStart(2,"0")}:${I.toString().padStart(2,"0")}`}const b=a=>{const[t,s,n]=a.split(":").map(Number);return t*3600+s*60+(n||0)},f=w.map(a=>{const t=_.find(m=>m.nama.toLowerCase()===a.nama.toLowerCase()&&new Date(m.tanggal_presensi).toISOString().split("T")[0]===new Date(a.tanggal_presensi).toISOString().split("T")[0]),s=(t==null?void 0:t.akhir_jam_masuk)||"23:59:59",n=b(a.jam_in),l=b(s),c=n>l?"Terlambat":"Tepat Waktu",x=c==="Terlambat"?P(a.jam_in,s):"00:00:00";return{...a,akhir_jam_masuk:s,status_terlambat:c,jam_keterlambatan:x,nama_jamkerja:t.nama_jamkerja,jam_pulang:t.jam_pulang}});o.useEffect(()=>{let a;return u&&setTimeout(()=>{const t=document.getElementById("map");if(!t){console.error("Elemen #map tidak ditemukan");return}console.log("Elemen #map ditemukan"),t._leaflet_id||(a=L.map("map").setView([r.latitude,r.longitude],13),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(a),L.marker([r.latitude,r.longitude]).addTo(a).bindPopup(`Lokasi Presensi ${r.nama}`).openPopup(),L.circle([r.latitude,r.longitude],{color:"red",fillColor:"#f03",fillOpacity:.5,radius:500}).addTo(a),console.log("Peta berhasil diinisialisasi"))},100),()=>{a&&(a.remove(),console.log("Peta dihapus"))}},[u,r]);const $=()=>new Date().toISOString().split("T")[0],F=f.filter(a=>a.tanggal_presensi===$()),D=p!==""?f:F,E=Math.ceil(w.length/i),y=D.slice(h*i,(h+1)*i);return e.jsx(e.Fragment,{children:e.jsx(A,{header:e.jsx(e.Fragment,{children:"Monitoring Presensi Pegawai"}),children:e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-6 bg-white shadow-md rounded-lg",children:[e.jsx(J,{title:"Monitoring Pegawai"}),e.jsxs("div",{className:"mx-auto max-w-7xl",children:[e.jsxs("div",{className:"relative flex items-center mb-6 max-w-96",children:[e.jsx(B,{className:"absolute left-3 text-gray-400"}),e.jsx("input",{className:"pl-10 pr-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 w-full",type:"text",placeholder:"Cari berdasarkan nama, email, tanggal, dll...",value:p,onChange:a=>S(a.target.value)})]}),e.jsx("div",{className:"w-full overflow-auto text-sm",children:e.jsxs("table",{className:"w-full border-collapse text-center",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1",children:"No"}),e.jsx("th",{className:"px-2 py-1",children:"Nama"}),e.jsx("th",{className:"px-2 py-2",children:"Shift Kerja"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Tanggal Presensi"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Jam Masuk"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Foto Masuk"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Jam Keluar"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Foto Keluar"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap",children:"Keterangan"}),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap"})]})}),e.jsx("tbody",{children:y.length>0?y.map((a,t)=>e.jsxs("tr",{className:"even:bg-gray-50 border-b border-gray-300",children:[e.jsx("td",{className:"px-2 py-1 text-center",children:h*i+t+1}),e.jsx("td",{className:"px-2 py-1 whitespace-nowrap",children:a.nama}),e.jsx("td",{className:"px-2 py-2",children:a.nama_jamkerja}),e.jsx("td",{className:"px-2 py-1 whitespace-nowrap",children:a.tanggal_presensi}),e.jsx("td",{className:"px-2 py-1",children:a.jam_in}),e.jsx("td",{className:"px-2 py-1",children:e.jsx("img",{src:a.foto_in?`/storage/uploads/absensi/${a.foto_in}`:"assets/img/nophoto.png",alt:"Foto Masuk",className:"h-12 w-12 object-cover"})}),e.jsx("td",{className:"px-2 py-1",children:a.jam_out?a.jam_out:new Date-new Date(a.tanggal_presensi)>24*60*60*1e3?e.jsx("span",{className:"",children:a.jam_pulang}):e.jsx("span",{className:"bg-red-600 text-white rounded px-3 text-center py-1 whitespace-nowrap",children:"Belum Absen"})}),e.jsx("td",{className:"px-2 py-1",children:e.jsx("img",{src:a.foto_out?`/storage/uploads/absensi/${a.foto_out}`:"/assets/img/nophoto.png",alt:"Foto Keluar",className:"h-12 w-12 object-cover"})}),e.jsx("td",{className:"px-2 py-1 whitespace-nowrap",children:a.status_terlambat==="Terlambat"?e.jsxs("span",{className:"bg-red-600 text-white px-2 py-1 rounded",children:["Terlambat"," ",a.jam_keterlambatan]}):e.jsx("span",{className:"bg-green-600 text-white px-2 py-1 rounded",children:"Tepat waktu"})}),e.jsx("td",{className:"px-2 py-1 whitespace-nowrap",children:e.jsx("button",{onClick:()=>v(a.lokasi_in,a.nama),children:e.jsx(G,{className:"text-xl hover:text-blue-500 hover:cursor-pointer"})})})]},a.id||t)):e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"text-center py-4 text-gray-500",children:"Tidak ada data presensi tersedia"})})})]})}),e.jsxs(W,{show:u,maxWidth:"3xl",closeable:!0,onClose:()=>j(!1),children:[e.jsx("h1",{className:"text-center font-semibold py-3 border border-b-black mb-3",children:"Lokasi Presensi User"}),e.jsx("div",{className:"h-96 w-full px-6 py-4 mb-7",children:e.jsx("div",{className:"h-96",id:"map"})})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx(R,{previousLabel:"← Sebelumnya",nextLabel:"Selanjutnya →",pageCount:E,onPageChange:C,containerClassName:"flex justify-center space-x-2",pageClassName:"px-4 py-2",previousClassName:"px-4 py-2",nextClassName:"px-4 py-2",activeClassName:"bg-blue-500 text-white font-bold"})})]})})})})}export{ee as default};
