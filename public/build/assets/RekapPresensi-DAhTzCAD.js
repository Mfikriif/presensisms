import{r as p,j as e}from"./app-Douwlqs5.js";import{A as S}from"./AuthenticatedLayout-DIpfNO7Y.js";import{F as A}from"./index-tAOw6B3u.js";import{M as $}from"./index-BTa2E4O8.js";import{u as h,w as B,F as C}from"./FileSaver.min-B9wpbE1Q.js";import"./ApplicationLogo-BqfOmbKl.js";import"./transition-BI978hq3.js";function L({namabulan:f=[],tahun_awal:x=2022}){const[r,b]=p.useState(""),[l,j]=p.useState(""),[c,o]=p.useState(!1),w=new Date().getFullYear(),y=()=>{if(!r||!l){alert("Pilih bulan, dan tahun terlebih dahulu.");return}const a=route("laporan.cetakPresensi")+`?bulan=${r}&tahun=${l}`;window.open(a,"_blank")},_=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","Novermber","Desember"],v=a=>_[a-1],T=async()=>{if(!r||!l){alert("Pilih bulan, dan tahun untuk melihat rekap presensi");return}o(!0);try{const a=await fetch(route("rekap.excel",{bulan:r,tahun:l}));if(!a.ok)throw new Error("Gagal mengambil data rekap presensi");const t=await a.json();if(!t.rekapPresensi||t.rekapPresensi.length===0){alert("Tidak ada rekap presensi untuk bulan dan tahun yang dipilih"),o(!1);return}if(!t.rekapKeterlambatan||Object.keys(t.rekapKeterlambatan).length===0){alert("Tidak ada rekap keterlambatan untuk bulan dan tahun yang dipilih"),o(!1);return}console.log(t);const N=t.rekapPresensi.reduce((u,n)=>{let s=u.find(i=>i["Nama Karyawan"]===n.nama_lengkap);s||(s={No:u.length+1,"Nama Karyawan":n.nama_lengkap,...Array.from({length:31},(i,m)=>[`Tanggal ${m+1}`,"- / -"]).reduce((i,[m,D])=>(i[m]=D,i),{}),TH:0,TT:0,TS:0,TI:0},u.push(s));const F=new Date(n.tanggal_presensi).getDate();s[`Tanggal ${F}`]=`${n.jam_in||"-"} / ${n.jam_out||"-"}`,s.TH+=1;const d=t.rekapKeterlambatan[n.kode_pegawai];return d&&d.jumlah_keterlambatan&&(s.TT=d.jumlah_keterlambatan),s.TS+=parseInt(n.total_sakit,10),s.TI+=parseInt(n.total_izin,10),u},[]),g=h.json_to_sheet(N);g["!cols"]=[{wch:5},{wch:25},...Array(31).fill({wch:10}),{wch:8},{wch:8}];const k=h.book_new();h.book_append_sheet(k,g,"Rekap Presensi");const P=B(k,{bookType:"xlsx",type:"array"}),E=new Blob([P],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});C.saveAs(E,`Rekap_Presensi_${v(r)}_${l}.xlsx`)}catch(a){console.error("Error exporting to Excel:",a),alert("Terjadi kesalahan saat meng-export data.")}finally{o(!1)}};return e.jsx(e.Fragment,{children:e.jsx(S,{header:e.jsx(e.Fragment,{children:"Rekap Presensi Pegawai"}),children:e.jsx(e.Fragment,{children:e.jsx("div",{className:"ml-20",children:e.jsxs("div",{className:"w-2/4 bg-white shadow-lg rounded-lg",children:[e.jsxs("div",{className:"flex flex-col px-5 py-5",children:[e.jsxs("select",{className:"mb-4 h-9 rounded-lg",name:"bulan",id:"bulan",value:r,onChange:a=>b(a.target.value),children:[e.jsx("option",{value:"",children:"Pilih Bulan"}),f.map((a,t)=>e.jsx("option",{value:t+1,children:a},t))]}),e.jsxs("select",{id:"tahun",value:l,onChange:a=>j(a.target.value),className:"mb-4 h-9 rounded-lg",children:[e.jsx("option",{value:"",children:"Tahun"}),Array.from({length:w-x+1},(a,t)=>x+t).map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{className:"w-9/12 mx-auto flex flex-row pb-4",children:[e.jsx("button",{onClick:y,disabled:c,className:"bg-green-600 mr-4 rounded-lg text-white w-full py-2",children:e.jsxs("div",{className:"flex justify-center",children:[e.jsx(A,{className:"my-auto mr-3"}),e.jsx("p",{children:"Cetak"})]})}),e.jsx("button",{className:"bg-blue-600 rounded-lg text-white w-full py-2",disabled:c,onClick:T,children:e.jsxs("div",{className:"flex justify-center",children:[e.jsx($,{className:"my-auto mr-3 text-xl"}),e.jsx("p",{children:c?"Exporting...":"Export to Excel"})]})})]})]})})})})})}export{L as default};
