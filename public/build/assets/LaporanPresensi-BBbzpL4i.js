import{r as m,j as e}from"./app-BXah4JEC.js";import{A as J}from"./AuthenticatedLayout-CuJPAzTV.js";import{F as M}from"./index-42D_VnN6.js";import{M as B}from"./index-D_0ykJcT.js";import{u as d,w as H,F as W}from"./FileSaver.min-D-887wMI.js";import"./ApplicationLogo-ErxAcPVl.js";import"./transition-CuP37XH4.js";function K({namabulan:_=[],tahun_awal:k=2022,namaPegawai:P}){const[o,v]=m.useState(""),[l,N]=m.useState(""),[u,T]=m.useState(""),[h,p]=m.useState(!1),y=new Date().getFullYear(),D=()=>{if(!o||!l||!u){alert("Pilih bulan, tahun, dan nama pegawai terlebih dahulu.");return}const a=route("laporan.cetakPegawai")+`?bulan=${o}&tahun=${l}&idPegawai=${u}`;window.open(a,"_blank")},w=a=>{if(!a)return 0;const[n,r,s]=a.split(":").map(Number);return n*3600+r*60+(s||0)},F=(a,n)=>{const r=w(a)-w(n);return r>0?`terlambat ${Math.floor(r/60)} menit`:"Tepat waktu"},E=(a,n)=>{if(!a||!n)return"-";const r=c=>{const[x,j]=c.split(":").map(Number);return x*60+j},s=r(n)-r(a);if(s<0)return"Waktu tidak valid";const i=Math.floor(s/60),g=s%60;return`${i} jam ${g} menit`},L=async()=>{var a,n,r;if(!o||!l||!u){alert("Pilih bulan, tahun, dan nama pegawai terlebih dahulu.");return}p(!0);try{const s=await fetch(route("laporan.exportExcel",{bulan:o,tahun:l,idPegawai:u}));if(!s.ok)throw new Error("Gagal mengambil data histori pegawai");const i=await s.json();if(!i.rekapLengkap||i.rekapLengkap.length===0||!i.dataPresensi||i.dataPresensi.length===0){alert("Tidak ada data status presensi untuk kriteria yang dipilih."),p(!1);return}const g=i.rekapLengkap.map((t,A)=>({No:A+1,Tanggal:t.tanggal||"-","Jam Presensi":t.jam_in||"-","Jam Pulang":t.jam_out||"-","Status ":!t.jam_in&&!t.jam_out?t.status==="i"?"Izin":t.status==="s"?"Sakit":"Tidak Hadir":t.jam_in&&t.jam_out?t.jam_in>t.jam_masuk?F(t.jam_in,t.jam_masuk):"Tepat Waktu":"Data Tidak Lengkap","Jumlah Jam":t.jam_out?E(t.jam_in,t.jam_out):"-"})),c=((a=i.dataPresensi[0])==null?void 0:a.nama)||"Tidak Diketahui",x=((n=i.dataPresensi[0])==null?void 0:n.posisi)||"Tidak Diketahui",j=((r=i.dataPresensi[0])==null?void 0:r.no_hp)||"Tidak Diketahui",f=d.aoa_to_sheet([]);d.sheet_add_aoa(f,[["Nama Pegawai",c],["Posisi",x],["Nomor HP",j],[]],{origin:"A1"}),d.sheet_add_json(f,g,{origin:"A5",skipHeader:!1});const b=d.book_new();d.book_append_sheet(b,f,"Laporan Presensi");const $=H(b,{bookType:"xlsx",type:"array"}),S=new Blob([$],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),C=`Laporan_Presensi_${c}_${o}_${l}.xlsx`;W.saveAs(S,C)}catch(s){console.error("Error fetching data:",s),alert(`Terjadi kesalahan saat mengambil data. ${s.message}`)}p(!1)};return e.jsx(e.Fragment,{children:e.jsx(J,{header:e.jsx(e.Fragment,{children:"Laporan Presensi"}),children:e.jsx(e.Fragment,{children:e.jsx("div",{className:"ml-20",children:e.jsxs("div",{className:" w-2/4 bg-white shadow-lg rounded-lg",children:[e.jsxs("div",{className:"flex flex-col px-5 py-5",children:[e.jsxs("select",{className:"mb-4 h-9 rounded-lg",name:"bulan",id:"bulan",value:o,onChange:a=>v(a.target.value),children:[e.jsx("option",{value:"",children:"Pilih Bulan"}),_.map((a,n)=>e.jsx("option",{value:n+1,children:a},n))]}),e.jsxs("select",{id:"tahun",value:l,onChange:a=>N(a.target.value),className:"mb-4 h-9 rounded-lg",children:[e.jsx("option",{value:"",children:"Tahun"}),Array.from({length:y-k+1},(a,n)=>k+n).map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsxs("select",{className:"mb-4 h-9 rounded-lg",name:"nama-pegawai",id:"idPegawai",value:u,onChange:a=>T(a.target.value),children:[e.jsx("option",{value:"",children:"Nama pegawai"}),P.map((a,n)=>e.jsx("option",{value:a.id,children:a.nama_lengkap},n))]})]}),e.jsxs("div",{className:"w-9/12 mx-auto flex flex-row pb-4",children:[e.jsx("button",{onClick:D,disabled:h,className:"bg-green-600 mr-4 rounded-lg text-white w-full py-2",children:e.jsxs("div",{className:"flex justify-center",children:[e.jsx(M,{className:"my-auto mr-3"}),e.jsx("p",{children:"Cetak"})]})}),e.jsx("button",{onClick:L,className:"bg-blue-600 rounded-lg text-white w-full py-2",disabled:h,children:e.jsxs("div",{className:"flex justify-center",children:[e.jsx(B,{className:"my-auto mr-3 text-xl"}),e.jsx("p",{children:h?"Exporting...":"Export to Excel"})]})})]})]})})})})})}export{K as default};
