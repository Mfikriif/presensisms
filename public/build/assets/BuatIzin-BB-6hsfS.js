import{r as l,j as e,M as y}from"./app-ar4AfqUK.js";import{M as C}from"./MainLayout-CWBrXy23.js";import{S as s}from"./sweetalert2.esm.all-BkU8I-GU.js";function N(){const[u,g]=l.useState(""),[o,h]=l.useState(""),[m,w]=l.useState(""),[n,p]=l.useState(null),[c,f]=l.useState(!1),x=async t=>{const a=t.target.value;g(a);try{await(await fetch("/presensi/cekpengajuanizin",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({tanggal_izin:a})})).json()===1?(f(!0),s.fire({title:"Oops!",text:"Anda sudah mengajukan izin pada tanggal ini! Silakan pilih tanggal lain.",icon:"warning",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"},didClose:()=>{g("")}})):f(!1)}catch(r){console.error("Error checking date:",r),s.fire({title:"Error!",text:"Terjadi kesalahan saat memeriksa tanggal izin.",icon:"error",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"}})}},b=async t=>{if(t.preventDefault(),c){s.fire({title:"Gagal!",text:"Anda sudah mengajukan izin untuk tanggal ini.",icon:"error",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"}});return}const a=new Date,r=new Date(u);if(a.setHours(0,0,0,0),r.setHours(0,0,0,0),r<a){s.fire({title:"Tanggal Tidak Valid",text:"Tanggal izin tidak boleh di hari kemarin atau sebelumnya.",icon:"warning",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"}});return}if(!u||!o||!m){s.fire({title:"Oops!",text:"Semua field wajib diisi.",icon:"warning",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"}});return}if(o==="s"&&!n){s.fire({title:"Oops!",text:"Bukti sakit wajib diunggah!",icon:"warning",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"}});return}const i=new FormData;i.append("tanggal_izin",u),i.append("status",o),i.append("keterangan",m),n&&i.append("file",n),i.append("_token",document.querySelector('meta[name="csrf-token"]').content);try{const d=await(await fetch("/presensi/storeizin",{method:"POST",body:i})).json();d.success?s.fire({title:"Berhasil!",text:d.message,icon:"success",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"},didClose:()=>{window.location.href="/presensi/izin"}}):s.fire({title:"Gagal!",text:d.message||"Terjadi kesalahan.",icon:"error",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"}})}catch{s.fire({title:"Error!",text:"Terjadi kesalahan saat mengirim data.",icon:"error",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"}})}},j=t=>{const a=t.target.files[0];if(a){if(a.type!=="application/pdf"){s.fire({title:"Format File Tidak Didukung",text:"Hanya diperbolehkan file dalam format PDF.",icon:"error",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"}}),t.target.value="",p(null);return}if(a.size>2*1024*1024){s.fire({title:"Ukuran File Terlalu Besar",text:"Maksimal ukuran file adalah 2MB.",icon:"error",timer:3e3,timerProgressBar:!0,showConfirmButton:!1,customClass:{popup:"custom-swal-popup",title:"custom-swal-title",content:"custom-swal-content"}}),t.target.value="",p(null);return}p(a)}};return e.jsxs(C,{children:[e.jsx(y,{title:"Buat Izin | E-Presensi SMS"}),e.jsxs("div",{className:"bg-gray-100 min-h-screen overflow-y-auto relative pt-16",children:[e.jsxs("div",{className:"fixed top-0 left-0 right-0 z-50 bg-blue-950 text-white flex items-center justify-between px-4 py-5 shadow-md",children:[e.jsxs("button",{onClick:()=>window.history.back(),className:"flex items-center text-white",children:[e.jsx("ion-icon",{name:"chevron-back-outline",className:"text-2xl"}),e.jsx("span",{className:"ml-2 text-base",children:"Kembali"})]}),e.jsx("h1",{className:"text-lg font-semibold",children:"Form Izin"})]}),e.jsx("div",{className:"p-4",children:e.jsxs("form",{onSubmit:b,className:"space-y-4",encType:"multipart/form-data",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"tanggal_izin",className:"block text-sm font-medium text-gray-700 mb-1",children:"Tanggal Izin"}),e.jsx("input",{type:"date",id:"tanggal_izin",name:"tanggal_izin",value:u,min:new Date().toISOString().split("T")[0],onChange:x,className:`w-full px-4 py-2 border rounded-md focus:ring ${c?"border-red-500 bg-red-100":"border-gray-300 focus:ring-blue-200 focus:border-blue-500"}`}),c&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Anda sudah mengajukan izin pada tanggal ini."})]}),e.jsx("div",{className:"form-group",children:e.jsxs("select",{name:"status",id:"status",value:o,onChange:t=>h(t.target.value),className:"w-full px-4 py-2 border rounded-md focus:ring focus:ring-blue-200 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Izin / Sakit"}),e.jsx("option",{value:"i",children:"Izin"}),e.jsx("option",{value:"s",children:"Sakit"})]})}),e.jsx("div",{className:"form-group",children:e.jsx("textarea",{name:"keterangan",id:"keterangan",value:m,onChange:t=>w(t.target.value),cols:"30",rows:"5",className:"w-full px-4 py-2 border rounded-md focus:ring focus:ring-blue-200 focus:border-blue-500",placeholder:"Keterangan"})}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"block text-md font-medium text-gray-700 mt-1 mb-1",children:["Upload Bukti Sakit (PDF)"," ",o==="s"&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"file",name:"file",accept:".pdf, .jpg, .jpeg, .png",onChange:j,className:"w-full px-4 py-2 border rounded-md focus:ring focus:ring-blue-200 focus:border-blue-500"}),o==="s"&&!n&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Bukti sakit wajib diunggah!"}),n&&n.type==="application/pdf"&&e.jsxs("p",{className:"text-green-600 text-sm mt-1",children:["File terpilih: ",n.name]})]}),e.jsx("div",{className:"form-group",children:e.jsx("button",{type:"submit",className:"w-full bg-blue-950 text-white py-2 px-4 rounded-md shadow hover:bg-blue-900 transition duration-200 disabled:bg-gray-400",disabled:c,children:"Kirim"})})]})})]})]})}export{N as default};
